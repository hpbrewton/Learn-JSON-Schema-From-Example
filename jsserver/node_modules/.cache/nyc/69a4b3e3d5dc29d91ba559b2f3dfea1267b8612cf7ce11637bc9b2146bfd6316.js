var cov_3fbapg1yz=function(){var path="/Users/hb/latlib/jsserver/javascript-algorithms/src/algorithms/graph/eulerian-path/eulerianPath.js";var hash="5735ac61a1eff9881986fff123a389cf18ca2e1d";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/hb/latlib/jsserver/javascript-algorithms/src/algorithms/graph/eulerian-path/eulerianPath.js",statementMap:{"0":{start:{line:10,column:31},end:{line:10,column:33}},"1":{start:{line:13,column:27},end:{line:13,column:29}},"2":{start:{line:16,column:26},end:{line:16,column:28}},"3":{start:{line:19,column:26},end:{line:19,column:28}},"4":{start:{line:20,column:2},end:{line:22,column:5}},"5":{start:{line:21,column:4},end:{line:21,column:46}},"6":{start:{line:26,column:2},end:{line:32,column:5}},"7":{start:{line:27,column:4},end:{line:31,column:5}},"8":{start:{line:28,column:6},end:{line:28,column:48}},"9":{start:{line:30,column:6},end:{line:30,column:49}},"10":{start:{line:38,column:20},end:{line:38,column:58}},"11":{start:{line:40,column:2},end:{line:42,column:3}},"12":{start:{line:41,column:4},end:{line:41,column:74}},"13":{start:{line:45,column:20},end:{line:45,column:24}},"14":{start:{line:47,column:2},end:{line:56,column:3}},"15":{start:{line:50,column:26},end:{line:50,column:58}},"16":{start:{line:51,column:4},end:{line:51,column:50}},"17":{start:{line:54,column:25},end:{line:54,column:56}},"18":{start:{line:55,column:4},end:{line:55,column:48}},"19":{start:{line:59,column:22},end:{line:59,column:33}},"20":{start:{line:60,column:2},end:{line:98,column:3}},"21":{start:{line:62,column:4},end:{line:62,column:45}},"22":{start:{line:67,column:20},end:{line:67,column:39}},"23":{start:{line:70,column:25},end:{line:70,column:49}},"24":{start:{line:72,column:23},end:{line:72,column:27}},"25":{start:{line:73,column:4},end:{line:79,column:5}},"26":{start:{line:75,column:6},end:{line:75,column:36}},"27":{start:{line:78,column:6},end:{line:78,column:76}},"28":{start:{line:78,column:51},end:{line:78,column:74}},"29":{start:{line:82,column:4},end:{line:86,column:5}},"30":{start:{line:83,column:6},end:{line:83,column:45}},"31":{start:{line:85,column:6},end:{line:85,column:47}},"32":{start:{line:89,column:4},end:{line:89,column:50}},"33":{start:{line:92,column:4},end:{line:94,column:5}},"34":{start:{line:93,column:6},end:{line:93,column:47}},"35":{start:{line:97,column:4},end:{line:97,column:35}},"36":{start:{line:100,column:2},end:{line:100,column:30}}},fnMap:{"0":{name:"eulerianPath",decl:{start:{line:9,column:24},end:{line:9,column:36}},loc:{start:{line:9,column:44},end:{line:101,column:1}},line:9},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:30},end:{line:20,column:31}},loc:{start:{line:20,column:42},end:{line:22,column:3}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:26,column:33},end:{line:26,column:34}},loc:{start:{line:26,column:45},end:{line:32,column:3}},line:26},"3":{name:"(anonymous_3)",decl:{start:{line:78,column:43},end:{line:78,column:44}},loc:{start:{line:78,column:51},end:{line:78,column:74}},line:78}},branchMap:{"0":{loc:{start:{line:27,column:4},end:{line:31,column:5}},type:"if",locations:[{start:{line:27,column:4},end:{line:31,column:5}},{start:{line:27,column:4},end:{line:31,column:5}}],line:27},"1":{loc:{start:{line:40,column:2},end:{line:42,column:3}},type:"if",locations:[{start:{line:40,column:2},end:{line:42,column:3}},{start:{line:40,column:2},end:{line:42,column:3}}],line:40},"2":{loc:{start:{line:40,column:6},end:{line:40,column:63}},type:"binary-expr",locations:[{start:{line:40,column:6},end:{line:40,column:16}},{start:{line:40,column:20},end:{line:40,column:63}}],line:40},"3":{loc:{start:{line:47,column:2},end:{line:56,column:3}},type:"if",locations:[{start:{line:47,column:2},end:{line:56,column:3}},{start:{line:47,column:2},end:{line:56,column:3}}],line:47},"4":{loc:{start:{line:73,column:4},end:{line:79,column:5}},type:"if",locations:[{start:{line:73,column:4},end:{line:79,column:5}},{start:{line:73,column:4},end:{line:79,column:5}}],line:73},"5":{loc:{start:{line:82,column:4},end:{line:86,column:5}},type:"if",locations:[{start:{line:82,column:4},end:{line:86,column:5}},{start:{line:82,column:4},end:{line:86,column:5}}],line:82},"6":{loc:{start:{line:92,column:4},end:{line:94,column:5}},type:"if",locations:[{start:{line:92,column:4},end:{line:94,column:5}},{start:{line:92,column:4},end:{line:94,column:5}}],line:92}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"5735ac61a1eff9881986fff123a389cf18ca2e1d"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();import graphBridges from'../bridges/graphBridges';/**
 * Fleury's algorithm of finding Eulerian Path (visit all graph edges exactly once).
 *
 * @param {Graph} graph
 * @return {GraphVertex[]}
 */export default function eulerianPath(graph){cov_3fbapg1yz.f[0]++;const eulerianPathVertices=(cov_3fbapg1yz.s[0]++,[]);// Set that contains all vertices with even rank (number of neighbors).
const evenRankVertices=(cov_3fbapg1yz.s[1]++,{});// Set that contains all vertices with odd rank (number of neighbors).
const oddRankVertices=(cov_3fbapg1yz.s[2]++,{});// Set of all not visited edges.
const notVisitedEdges=(cov_3fbapg1yz.s[3]++,{});cov_3fbapg1yz.s[4]++;graph.getAllEdges().forEach(vertex=>{cov_3fbapg1yz.f[1]++;cov_3fbapg1yz.s[5]++;notVisitedEdges[vertex.getKey()]=vertex;});// Detect whether graph contains Eulerian Circuit or Eulerian Path or none of them.
/** @params {GraphVertex} vertex */cov_3fbapg1yz.s[6]++;graph.getAllVertices().forEach(vertex=>{cov_3fbapg1yz.f[2]++;cov_3fbapg1yz.s[7]++;if(vertex.getDegree()%2){cov_3fbapg1yz.b[0][0]++;cov_3fbapg1yz.s[8]++;oddRankVertices[vertex.getKey()]=vertex;}else{cov_3fbapg1yz.b[0][1]++;cov_3fbapg1yz.s[9]++;evenRankVertices[vertex.getKey()]=vertex;}});// Check whether we're dealing with Eulerian Circuit or Eulerian Path only.
// Graph would be an Eulerian Circuit in case if all its vertices has even degree.
// If not all vertices have even degree then graph must contain only two odd-degree
// vertices in order to have Euler Path.
const isCircuit=(cov_3fbapg1yz.s[10]++,!Object.values(oddRankVertices).length);cov_3fbapg1yz.s[11]++;if((cov_3fbapg1yz.b[2][0]++,!isCircuit)&&(cov_3fbapg1yz.b[2][1]++,Object.values(oddRankVertices).length!==2)){cov_3fbapg1yz.b[1][0]++;cov_3fbapg1yz.s[12]++;throw new Error('Eulerian path must contain two odd-ranked vertices');}else{cov_3fbapg1yz.b[1][1]++;}// Pick start vertex for traversal.
let startVertex=(cov_3fbapg1yz.s[13]++,null);cov_3fbapg1yz.s[14]++;if(isCircuit){cov_3fbapg1yz.b[3][0]++;// For Eulerian Circuit it doesn't matter from what vertex to start thus we'll just
// peek a first node.
const evenVertexKey=(cov_3fbapg1yz.s[15]++,Object.keys(evenRankVertices)[0]);cov_3fbapg1yz.s[16]++;startVertex=evenRankVertices[evenVertexKey];}else{cov_3fbapg1yz.b[3][1]++;// For Eulerian Path we need to start from one of two odd-degree vertices.
const oddVertexKey=(cov_3fbapg1yz.s[17]++,Object.keys(oddRankVertices)[0]);cov_3fbapg1yz.s[18]++;startVertex=oddRankVertices[oddVertexKey];}// Start traversing the graph.
let currentVertex=(cov_3fbapg1yz.s[19]++,startVertex);cov_3fbapg1yz.s[20]++;while(Object.values(notVisitedEdges).length){cov_3fbapg1yz.s[21]++;// Add current vertex to Eulerian path.
eulerianPathVertices.push(currentVertex);// Detect all bridges in graph.
// We need to do it in order to not delete bridges if there are other edges
// exists for deletion.
const bridges=(cov_3fbapg1yz.s[22]++,graphBridges(graph));// Peek the next edge to delete from graph.
const currentEdges=(cov_3fbapg1yz.s[23]++,currentVertex.getEdges());/** @var {GraphEdge} edgeToDelete */let edgeToDelete=(cov_3fbapg1yz.s[24]++,null);cov_3fbapg1yz.s[25]++;if(currentEdges.length===1){cov_3fbapg1yz.b[4][0]++;cov_3fbapg1yz.s[26]++;// If there is only one edge left we need to peek it.
[edgeToDelete]=currentEdges;}else{cov_3fbapg1yz.b[4][1]++;cov_3fbapg1yz.s[27]++;// If there are many edges left then we need to peek any of those except bridges.
[edgeToDelete]=currentEdges.filter(edge=>{cov_3fbapg1yz.f[3]++;cov_3fbapg1yz.s[28]++;return!bridges[edge.getKey()];});}// Detect next current vertex.
cov_3fbapg1yz.s[29]++;if(currentVertex.getKey()===edgeToDelete.startVertex.getKey()){cov_3fbapg1yz.b[5][0]++;cov_3fbapg1yz.s[30]++;currentVertex=edgeToDelete.endVertex;}else{cov_3fbapg1yz.b[5][1]++;cov_3fbapg1yz.s[31]++;currentVertex=edgeToDelete.startVertex;}// Delete edge from not visited edges set.
cov_3fbapg1yz.s[32]++;delete notVisitedEdges[edgeToDelete.getKey()];// If last edge were deleted then add finish vertex to Eulerian Path.
cov_3fbapg1yz.s[33]++;if(Object.values(notVisitedEdges).length===0){cov_3fbapg1yz.b[6][0]++;cov_3fbapg1yz.s[34]++;eulerianPathVertices.push(currentVertex);}else{cov_3fbapg1yz.b[6][1]++;}// Delete the edge from graph.
cov_3fbapg1yz.s[35]++;graph.deleteEdge(edgeToDelete);}cov_3fbapg1yz.s[36]++;return eulerianPathVertices;}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9oYi9sYXRsaWIvanNzZXJ2ZXIvamF2YXNjcmlwdC1hbGdvcml0aG1zL3NyYy9hbGdvcml0aG1zL2dyYXBoL2V1bGVyaWFuLXBhdGgvZXVsZXJpYW5QYXRoLmpzIl0sIm5hbWVzIjpbImdyYXBoQnJpZGdlcyIsImV1bGVyaWFuUGF0aCIsImdyYXBoIiwiZXVsZXJpYW5QYXRoVmVydGljZXMiLCJldmVuUmFua1ZlcnRpY2VzIiwib2RkUmFua1ZlcnRpY2VzIiwibm90VmlzaXRlZEVkZ2VzIiwiZ2V0QWxsRWRnZXMiLCJmb3JFYWNoIiwidmVydGV4IiwiZ2V0S2V5IiwiZ2V0QWxsVmVydGljZXMiLCJnZXREZWdyZWUiLCJpc0NpcmN1aXQiLCJPYmplY3QiLCJ2YWx1ZXMiLCJsZW5ndGgiLCJFcnJvciIsInN0YXJ0VmVydGV4IiwiZXZlblZlcnRleEtleSIsImtleXMiLCJvZGRWZXJ0ZXhLZXkiLCJjdXJyZW50VmVydGV4IiwicHVzaCIsImJyaWRnZXMiLCJjdXJyZW50RWRnZXMiLCJnZXRFZGdlcyIsImVkZ2VUb0RlbGV0ZSIsImZpbHRlciIsImVkZ2UiLCJlbmRWZXJ0ZXgiLCJkZWxldGVFZGdlIl0sIm1hcHBpbmdzIjoiaTZKQUFBLE1BQU9BLENBQUFBLFlBQVAsS0FBeUIseUJBQXpCLENBRUE7Ozs7O0dBTUEsY0FBZSxTQUFTQyxDQUFBQSxZQUFULENBQXNCQyxLQUF0QixDQUE2QixzQkFDMUMsS0FBTUMsQ0FBQUEsb0JBQW9CLHVCQUFHLEVBQUgsQ0FBMUIsQ0FFQTtBQUNBLEtBQU1DLENBQUFBLGdCQUFnQix1QkFBRyxFQUFILENBQXRCLENBRUE7QUFDQSxLQUFNQyxDQUFBQSxlQUFlLHVCQUFHLEVBQUgsQ0FBckIsQ0FFQTtBQUNBLEtBQU1DLENBQUFBLGVBQWUsdUJBQUcsRUFBSCxDQUFyQixDQVYwQyxxQkFXMUNKLEtBQUssQ0FBQ0ssV0FBTixHQUFvQkMsT0FBcEIsQ0FBNkJDLE1BQUQsRUFBWSwyQ0FDdENILGVBQWUsQ0FBQ0csTUFB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LENBQWNULGVBQWQsRUFBK0JVLE1BQS9CLEdBQTBDLENBQTlDLENBQWlELCtDQUMvQ2Isb0JBQW9CLENBQUNvQixJQUFyQixDQUEwQkQsYUFBMUIsRUFDRCxDQUZELDhCQUlBO0FBcEM0QyxzQkFxQzVDcEIsS0FBSyxDQUFDNkIsVUFBTixDQUFpQkosWUFBakIsRUFDRCxDQXpGeUMsc0JBMkYxQyxNQUFPeEIsQ0FBQUEsb0JBQVAsQ0FDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBncmFwaEJyaWRnZXMgZnJvbSAnLi4vYnJpZGdlcy9ncmFwaEJyaWRnZXMnO1xuXG4vKipcbiAqIEZsZXVyeSdzIGFsZ29yaXRobSBvZiBmaW5kaW5nIEV1bGVyaWFuIFBhdGggKHZpc2l0IGFsbCBncmFwaCBlZGdlcyBleGFjdGx5IG9uY2UpLlxuICpcbiAqIEBwYXJhbSB7R3JhcGh9IGdyYXBoXG4gKiBAcmV0dXJuIHtHcmFwaFZlcnRleFtdfVxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBldWxlcmlhblBhdGgoZ3JhcGgpIHtcbiAgY29uc3QgZXVsZXJpYW5QYXRoVmVydGljZXMgPSBbXTtcblxuICAvLyBTZXQgdGhhdCBjb250YWlucyBhbGwgdmVydGljZXMgd2l0aCBldmVuIHJhbmsgKG51bWJlciBvZiBuZWlnaGJvcnMpLlxuICBjb25zdCBldmVuUmFua1ZlcnRpY2VzID0ge307XG5cbiAgLy8gU2V0IHRoYXQgY29udGFpbnMgYWxsIHZlcnRpY2VzIHdpdGggb2RkIHJhbmsgKG51bWJlciBvZiBuZWlnaGJvcnMpLlxuICBjb25zdCBvZGRSYW5rVmVydGljZXMgPSB7fTtcblxuICAvLyBTZXQgb2YgYWxsIG5vdCB2aXNpdGVkIGVkZ2VzLlxuICBjb25zdCBub3RWaXNpdGVkRWRnZXMgPSB7fTtcbiAgZ3JhcGguZ2V0QWxsRWRnZXMoKS5mb3JFYWNoKCh2ZXJ0ZXgpID0+IHtcbiAgICBub3RWaXNpdGVkRWRnZXNbdmVydGV4LmdldEtleSgpXSA9IHZlcnRleDtcbiAgfSk7XG5cbiAgLy8gRGV0ZWN0IHdoZXRoZXIgZ3JhcGggY29udGFpbnMgRXVsZXJpYW4gQ2lyY3VpdCBvciBFdWxlcmlhbiBQYXRoIG9yIG5vbmUgb2YgdGhlbS5cbiAgLyoqIEBwYXJhbXMge0dyYXBoVmVydGV4fSB2ZXJ0ZXggKi9cbiAgZ3JhcGguZ2V0QWxsVmVydGljZXMoKS5mb3JFYWNoKCh2ZXJ0ZXgpID0+IHtcbiAgICBpZiAodmVydGV4LmdldERlZ3JlZSgpICUgMikge1xuICAgICAgb2RkUmFua1ZlcnRpY2VzW3ZlcnRleC5nZXRLZXkoKV0gPSB2ZXJ0ZXg7XG4gICAgfSBlbHNlIHtcbiAgICAgIGV2ZW5SYW5rVmVydGljZXNbdmVydGV4LmdldEtleSgpXSA9IHZlcnRleDtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIENoZWNrIHdoZXRoZXIgd2UncmUgZGVhbGluZyB3aXRoIEV1bGVyaWFuIENpcmN1aXQgb3IgRXVsZXJpYW4gUGF0aCBvbmx5LlxuICAvLyBHcmFwaCB3b3VsZCBiZSBhbiBFdWxlcmlhbiBDaXJjdWl0IGluIGNhc2UgaWYgYWxsIGl0cyB2ZXJ0aWNlcyBoYXMgZXZlbiBkZWdyZWUuXG4gIC8vIElmIG5vdCBhbGwgdmVydGljZXMgaGF2ZSBldmVuIGRlZ3JlZSB0aGVuIGdyYXBoIG11c3QgY29udGFpbiBvbmx5IHR3byBvZGQtZGVncmVlXG4gIC8vIHZlcnRpY2VzIGluIG9yZGVyIHRvIGhhdmUgRXVsZXIgUGF0aC5cbiAgY29uc3QgaXNDaXJjdWl0ID0gIU9iamVjdC52YWx1ZXMob2RkUmFua1ZlcnRpY2VzKS5sZW5ndGg7XG5cbiAgaWYgKCFpc0NpcmN1aXQgJiYgT2JqZWN0LnZhbHVlcyhvZGRSYW5rVmVydGljZXMpLmxlbmd0aCAhPT0gMikge1xuICAgIHRocm93IG5ldyBFcnJvcignRXVsZXJpYW4gcGF0aCBtdXN0IGNvbnRhaW4gdHdvIG9kZC1yYW5rZWQgdmVydGljZXMnKTtcbiAgfVxuXG4gIC8vIFBpY2sgc3RhcnQgdmVydGV4IGZvciB0cmF2ZXJzYWwuXG4gIGxldCBzdGFydFZlcnRleCA9IG51bGw7XG5cbiAgaWYgKGlzQ2lyY3VpdCkge1xuICAgIC8vIEZvciBFdWxlcmlhbiBDaXJjdWl0IGl0IGRvZXNuJ3QgbWF0dGVyIGZyb20gd2hhdCB2ZXJ0ZXggdG8gc3RhcnQgdGh1cyB3ZSdsbCBqdXN0XG4gICAgLy8gcGVlayBhIGZpcnN0IG5vZGUuXG4gICAgY29uc3QgZXZlblZlcnRleEtleSA9IE9iamVjdC5rZXlzKGV2ZW5SYW5rVmVydGljZXMpWzBdO1xuICAgIHN0YXJ0VmVydGV4ID0gZXZlblJhbmtWZXJ0aWNlc1tldmVuVmVydGV4S2V5XTtcbiAgfSBlbHNlIHtcbiAgICAvLyBGb3IgRXVsZXJpYW4gUGF0aCB3ZSBuZWVkIHRvIHN0YXJ0IGZyb20gb25lIG9mIHR3byBvZGQtZGVncmVlIHZlcnRpY2VzLlxuICAgIGNvbnN0IG9kZFZlcnRleEtleSA9IE9iamVjdC5rZXlzKG9kZFJhbmtWZXJ0aWNlcylbMF07XG4gICAgc3RhcnRWZXJ0ZXggPSBvZGRSYW5rVmVydGljZXNbb2RkVmVydGV4S2V5XTtcbiAgfVxuXG4gIC8vIFN0YXJ0IHRyYXZlcnNpbmcgdGhlIGdyYXBoLlxuICBsZXQgY3VycmVudFZlcnRleCA9IHN0YXJ0VmVydGV4O1xuICB3aGlsZSAoT2JqZWN0LnZhbHVlcyhub3RWaXNpdGVkRWRnZXMpLmxlbmd0aCkge1xuICAgIC8vIEFkZCBjdXJyZW50IHZlcnRleCB0byBFdWxlcmlhbiBwYXRoLlxuICAgIGV1bGVyaWFuUGF0aFZlcnRpY2VzLnB1c2goY3VycmVudFZlcnRleCk7XG5cbiAgICAvLyBEZXRlY3QgYWxsIGJyaWRnZXMgaW4gZ3JhcGguXG4gICAgLy8gV2UgbmVlZCB0byBkbyBpdCBpbiBvcmRlciB0byBub3QgZGVsZXRlIGJyaWRnZXMgaWYgdGhlcmUgYXJlIG90aGVyIGVkZ2VzXG4gICAgLy8gZXhpc3RzIGZvciBkZWxldGlvbi5cbiAgICBjb25zdCBicmlkZ2VzID0gZ3JhcGhCcmlkZ2VzKGdyYXBoKTtcblxuICAgIC8vIFBlZWsgdGhlIG5leHQgZWRnZSB0byBkZWxldGUgZnJvbSBncmFwaC5cbiAgICBjb25zdCBjdXJyZW50RWRnZXMgPSBjdXJyZW50VmVydGV4LmdldEVkZ2VzKCk7XG4gICAgLyoqIEB2YXIge0dyYXBoRWRnZX0gZWRnZVRvRGVsZXRlICovXG4gICAgbGV0IGVkZ2VUb0RlbGV0ZSA9IG51bGw7XG4gICAgaWYgKGN1cnJlbnRFZGdlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgIC8vIElmIHRoZXJlIGlzIG9ubHkgb25lIGVkZ2UgbGVmdCB3ZSBuZWVkIHRvIHBlZWsgaXQuXG4gICAgICBbZWRnZVRvRGVsZXRlXSA9IGN1cnJlbnRFZGdlcztcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgdGhlcmUgYXJlIG1hbnkgZWRnZXMgbGVmdCB0aGVuIHdlIG5lZWQgdG8gcGVlayBhbnkgb2YgdGhvc2UgZXhjZXB0IGJyaWRnZXMuXG4gICAgICBbZWRnZVRvRGVsZXRlXSA9IGN1cnJlbnRFZGdlcy5maWx0ZXIoZWRnZSA9PiAhYnJpZGdlc1tlZGdlLmdldEtleSgpXSk7XG4gICAgfVxuXG4gICAgLy8gRGV0ZWN0IG5leHQgY3VycmVudCB2ZXJ0ZXguXG4gICAgaWYgKGN1cnJlbnRWZXJ0ZXguZ2V0S2V5KCkgPT09IGVkZ2VUb0RlbGV0ZS5zdGFydFZlcnRleC5nZXRLZXkoKSkge1xuICAgICAgY3VycmVudFZlcnRleCA9IGVkZ2VUb0RlbGV0ZS5lbmRWZXJ0ZXg7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1cnJlbnRWZXJ0ZXggPSBlZGdlVG9EZWxldGUuc3RhcnRWZXJ0ZXg7XG4gICAgfVxuXG4gICAgLy8gRGVsZXRlIGVkZ2UgZnJvbSBub3QgdmlzaXRlZCBlZGdlcyBzZXQuXG4gICAgZGVsZXRlIG5vdFZpc2l0ZWRFZGdlc1tlZGdlVG9EZWxldGUuZ2V0S2V5KCldO1xuXG4gICAgLy8gSWYgbGFzdCBlZGdlIHdlcmUgZGVsZXRlZCB0aGVuIGFkZCBmaW5pc2ggdmVydGV4IHRvIEV1bGVyaWFuIFBhdGguXG4gICAgaWYgKE9iamVjdC52YWx1ZXMobm90VmlzaXRlZEVkZ2VzKS5sZW5ndGggPT09IDApIHtcbiAgICAgIGV1bGVyaWFuUGF0aFZlcnRpY2VzLnB1c2goY3VycmVudFZlcnRleCk7XG4gICAgfVxuXG4gICAgLy8gRGVsZXRlIHRoZSBlZGdlIGZyb20gZ3JhcGguXG4gICAgZ3JhcGguZGVsZXRlRWRnZShlZGdlVG9EZWxldGUpO1xuICB9XG5cbiAgcmV0dXJuIGV1bGVyaWFuUGF0aFZlcnRpY2VzO1xufVxuIl19