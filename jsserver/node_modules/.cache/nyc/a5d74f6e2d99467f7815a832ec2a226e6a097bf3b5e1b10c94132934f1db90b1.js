var cov_1ybuwanchj=function(){var path="/Users/hb/latlib/jsserver/javascript-algorithms/src/algorithms/graph/strongly-connected-components/stronglyConnectedComponents.js";var hash="710e8099901711f097a63c6787edd5ab5a01e29f";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/hb/latlib/jsserver/javascript-algorithms/src/algorithms/graph/strongly-connected-components/stronglyConnectedComponents.js",statementMap:{"0":{start:{line:10,column:29},end:{line:10,column:31}},"1":{start:{line:16,column:34},end:{line:16,column:45}},"2":{start:{line:19,column:32},end:{line:19,column:34}},"3":{start:{line:20,column:2},end:{line:22,column:5}},"4":{start:{line:21,column:4},end:{line:21,column:52}},"5":{start:{line:25,column:23},end:{line:42,column:3}},"6":{start:{line:28,column:6},end:{line:28,column:65}},"7":{start:{line:31,column:6},end:{line:31,column:59}},"8":{start:{line:36,column:6},end:{line:36,column:50}},"9":{start:{line:40,column:6},end:{line:40,column:54}},"10":{start:{line:45,column:2},end:{line:52,column:3}},"11":{start:{line:47,column:27},end:{line:47,column:64}},"12":{start:{line:48,column:24},end:{line:48,column:61}},"13":{start:{line:49,column:4},end:{line:49,column:49}},"14":{start:{line:51,column:4},end:{line:51,column:55}},"15":{start:{line:54,column:2},end:{line:54,column:33}},"16":{start:{line:64,column:42},end:{line:64,column:44}},"17":{start:{line:67,column:39},end:{line:67,column:41}},"18":{start:{line:70,column:29},end:{line:70,column:31}},"19":{start:{line:73,column:23},end:{line:94,column:3}},"20":{start:{line:76,column:6},end:{line:76,column:57}},"21":{start:{line:79,column:6},end:{line:79,column:65}},"22":{start:{line:86,column:6},end:{line:88,column:7}},"23":{start:{line:87,column:8},end:{line:87,column:82}},"24":{start:{line:92,column:6},end:{line:92,column:54}},"25":{start:{line:96,column:2},end:{line:108,column:3}},"26":{start:{line:98,column:24},end:{line:98,column:50}},"27":{start:{line:101,column:4},end:{line:101,column:40}},"28":{start:{line:104,column:4},end:{line:107,column:5}},"29":{start:{line:106,column:6},end:{line:106,column:57}},"30":{start:{line:110,column:2},end:{line:110,column:41}},"31":{start:{line:126,column:31},end:{line:126,column:70}},"32":{start:{line:129,column:2},end:{line:129,column:18}},"33":{start:{line:132,column:2},end:{line:132,column:49}}},fnMap:{"0":{name:"getVerticesSortedByDfsFinishTime",decl:{start:{line:8,column:9},end:{line:8,column:41}},loc:{start:{line:8,column:49},end:{line:55,column:1}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:33},end:{line:20,column:34}},loc:{start:{line:20,column:45},end:{line:22,column:3}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:26,column:17},end:{line:26,column:18}},loc:{start:{line:26,column:40},end:{line:32,column:5}},line:26},"3":{name:"(anonymous_3)",decl:{start:{line:33,column:17},end:{line:33,column:18}},loc:{start:{line:33,column:40},end:{line:37,column:5}},line:33},"4":{name:"(anonymous_4)",decl:{start:{line:38,column:20},end:{line:38,column:21}},loc:{start:{line:38,column:40},end:{line:41,column:5}},line:38},"5":{name:"getSCCSets",decl:{start:{line:62,column:9},end:{line:62,column:19}},loc:{start:{line:62,column:49},end:{line:111,column:1}},line:62},"6":{name:"(anonymous_6)",decl:{start:{line:74,column:17},end:{line:74,column:18}},loc:{start:{line:74,column:40},end:{line:80,column:5}},line:74},"7":{name:"(anonymous_7)",decl:{start:{line:81,column:17},end:{line:81,column:18}},loc:{start:{line:81,column:41},end:{line:89,column:5}},line:81},"8":{name:"(anonymous_8)",decl:{start:{line:90,column:20},end:{line:90,column:21}},loc:{start:{line:90,column:40},end:{line:93,column:5}},line:90},"9":{name:"stronglyConnectedComponents",decl:{start:{line:119,column:24},end:{line:119,column:51}},loc:{start:{line:119,column:59},end:{line:133,column:1}},line:119}},branchMap:{"0":{loc:{start:{line:86,column:6},end:{line:88,column:7}},type:"if",locations:[{start:{line:86,column:6},end:{line:88,column:7}},{start:{line:86,column:6},end:{line:88,column:7}}],line:86},"1":{loc:{start:{line:104,column:4},end:{line:107,column:5}},type:"if",locations:[{start:{line:104,column:4},end:{line:107,column:5}},{start:{line:104,column:4},end:{line:107,column:5}}],line:104}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"710e8099901711f097a63c6787edd5ab5a01e29f"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();import Stack from'../../../data-structures/stack/Stack';import depthFirstSearch from'../depth-first-search/depthFirstSearch';/**
 * @param {Graph} graph
 * @return {Stack}
 */function getVerticesSortedByDfsFinishTime(graph){cov_1ybuwanchj.f[0]++;// Set of all visited vertices during DFS pass.
const visitedVerticesSet=(cov_1ybuwanchj.s[0]++,{});// Stack of vertices by finish time.
// All vertices in this stack are ordered by finished time in decreasing order.
// Vertex that has been finished first will be at the bottom of the stack and
// vertex that has been finished last will be at the top of the stack.
const verticesByDfsFinishTime=(cov_1ybuwanchj.s[1]++,new Stack());// Set of all vertices we're going to visit.
const notVisitedVerticesSet=(cov_1ybuwanchj.s[2]++,{});cov_1ybuwanchj.s[3]++;graph.getAllVertices().forEach(vertex=>{cov_1ybuwanchj.f[1]++;cov_1ybuwanchj.s[4]++;notVisitedVerticesSet[vertex.getKey()]=vertex;});// Specify DFS traversal callbacks.
const dfsCallbacks=(cov_1ybuwanchj.s[5]++,{enterVertex:({currentVertex})=>{cov_1ybuwanchj.f[2]++;cov_1ybuwanchj.s[6]++;// Add current vertex to visited set.
visitedVerticesSet[currentVertex.getKey()]=currentVertex;// Delete current vertex from not visited set.
cov_1ybuwanchj.s[7]++;delete notVisitedVerticesSet[currentVertex.getKey()];},leaveVertex:({currentVertex})=>{cov_1ybuwanchj.f[3]++;cov_1ybuwanchj.s[8]++;// Push vertex to the stack when leaving it.
// This will make stack to be ordered by finish time in decreasing order.
verticesByDfsFinishTime.push(currentVertex);},allowTraversal:({nextVertex})=>{cov_1ybuwanchj.f[4]++;cov_1ybuwanchj.s[9]++;// Don't allow to traverse the nodes that have been already visited.
return!visitedVerticesSet[nextVertex.getKey()];}});// Do FIRST DFS PASS traversal for all graph vertices to fill the verticesByFinishTime stack.
cov_1ybuwanchj.s[10]++;while(Object.values(notVisitedVerticesSet).length){// Peek any vertex to start DFS traversal from.
const startVertexKey=(cov_1ybuwanchj.s[11]++,Object.keys(notVisitedVerticesSet)[0]);const startVertex=(cov_1ybuwanchj.s[12]++,notVisitedVerticesSet[startVertexKey]);cov_1ybuwanchj.s[13]++;delete notVisitedVerticesSet[startVertexKey];cov_1ybuwanchj.s[14]++;depthFirstSearch(graph,startVertex,dfsCallbacks);}cov_1ybuwanchj.s[15]++;return verticesByDfsFinishTime;}/**
 * @param {Graph} graph
 * @param {Stack} verticesByFinishTime
 * @return {*[]}
 */function getSCCSets(graph,verticesByFinishTime){cov_1ybuwanchj.f[5]++;// Array of arrays of strongly connected vertices.
const stronglyConnectedComponentsSets=(cov_1ybuwanchj.s[16]++,[]);// Array that will hold all vertices that are being visited during one DFS run.
let stronglyConnectedComponentsSet=(cov_1ybuwanchj.s[17]++,[]);// Visited vertices set.
const visitedVerticesSet=(cov_1ybuwanchj.s[18]++,{});// Callbacks for DFS traversal.
const dfsCallbacks=(cov_1ybuwanchj.s[19]++,{enterVertex:({currentVertex})=>{cov_1ybuwanchj.f[6]++;cov_1ybuwanchj.s[20]++;// Add current vertex to SCC set of current DFS round.
stronglyConnectedComponentsSet.push(currentVertex);// Add current vertex to visited set.
cov_1ybuwanchj.s[21]++;visitedVerticesSet[currentVertex.getKey()]=currentVertex;},leaveVertex:({previousVertex})=>{cov_1ybuwanchj.f[7]++;cov_1ybuwanchj.s[22]++;// Once DFS traversal is finished push the set of found strongly connected
// components during current DFS round to overall strongly connected components set.
// The sign that traversal is about to be finished is that we came back to start vertex
// which doesn't have parent.
if(previousVertex===null){cov_1ybuwanchj.b[0][0]++;cov_1ybuwanchj.s[23]++;stronglyConnectedComponentsSets.push([...stronglyConnectedComponentsSet]);}else{cov_1ybuwanchj.b[0][1]++;}},allowTraversal:({nextVertex})=>{cov_1ybuwanchj.f[8]++;cov_1ybuwanchj.s[24]++;// Don't allow traversal of already visited vertices.
return!visitedVerticesSet[nextVertex.getKey()];}});cov_1ybuwanchj.s[25]++;while(!verticesByFinishTime.isEmpty()){/** @var {GraphVertex} startVertex */const startVertex=(cov_1ybuwanchj.s[26]++,verticesByFinishTime.pop());// Reset the set of strongly connected vertices.
cov_1ybuwanchj.s[27]++;stronglyConnectedComponentsSet=[];// Don't do DFS on already visited vertices.
cov_1ybuwanchj.s[28]++;if(!visitedVerticesSet[startVertex.getKey()]){cov_1ybuwanchj.b[1][0]++;cov_1ybuwanchj.s[29]++;// Do DFS traversal.
depthFirstSearch(graph,startVertex,dfsCallbacks);}else{cov_1ybuwanchj.b[1][1]++;}}cov_1ybuwanchj.s[30]++;return stronglyConnectedComponentsSets;}/**
 * Kosaraju's algorithm.
 *
 * @param {Graph} graph
 * @return {*[]}
 */export default function stronglyConnectedComponents(graph){cov_1ybuwanchj.f[9]++;// In this algorithm we will need to do TWO DFS PASSES overt the graph.
// Get stack of vertices ordered by DFS finish time.
// All vertices in this stack are ordered by finished time in decreasing order:
// Vertex that has been finished first will be at the bottom of the stack and
// vertex that has been finished last will be at the top of the stack.
const verticesByFinishTime=(cov_1ybuwanchj.s[31]++,getVerticesSortedByDfsFinishTime(graph));// Reverse the graph.
cov_1ybuwanchj.s[32]++;graph.reverse();// Do DFS once again on reversed graph.
cov_1ybuwanchj.s[33]++;return getSCCSets(graph,verticesByFinishTime);}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9oYi9sYXRsaWIvanNzZXJ2ZXIvamF2YXNjcmlwdC1hbGdvcml0aG1zL3NyYy9hbGdvcml0aG1zL2dyYXBoL3N0cm9uZ2x5LWNvbm5lY3RlZC1jb21wb25lbnRzL3N0cm9uZ2x5Q29ubmVjdGVkQ29tcG9uZW50cy5qcyJdLCJuYW1lcyI6WyJTdGFjayIsImRlcHRoRmlyc3RTZWFyY2giLCJnZXRWZXJ0aWNlc1NvcnRlZEJ5RGZzRmluaXNoVGltZSIsImdyYXBoIiwidmlzaXRlZFZlcnRpY2VzU2V0IiwidmVydGljZXNCeURmc0ZpbmlzaFRpbWUiLCJub3RWaXNpdGVkVmVydGljZXNTZXQiLCJnZXRBbGxWZXJ0aWNlcyIsImZvckVhY2giLCJ2ZXJ0ZXgiLCJnZXRLZXkiLCJkZnNDYWxsYmFja3MiLCJlbnRlclZlcnRleCIsImN1cnJlbnRWZXJ0ZXgiLCJsZWF2ZVZlcnRleCIsInB1c2giLCJhbGxvd1RyYXZlcnNhbCIsIm5leHRWZXJ0ZXgiLCJPYmplY3QiLCJ2YWx1ZXMiLCJsZW5ndGgiLCJzdGFydFZlcnRleEtleSIsImtleXMiLCJzdGFydFZlcnRleCIsImdldFNDQ1NldHMiLCJ2ZXJ0aWNlc0J5RmluaXNoVGltZSIsInN0cm9uZ2x5Q29ubmVjdGVkQ29tcG9uZW50c1NldHMiLCJzdHJvbmdseUNvbm5lY3RlZENvbXBvbmVudHNTZXQiLCJwcmV2aW91c1ZlcnRleCIsImlzRW1wdHkiLCJwb3AiLCJzdHJvbmdseUNvbm5lY3RlZENvbXBvbmVudHMiLCJyZXZlcnNlIl0sIm1hcHBpbmdzIjoiMHZKQUFBLE1BQU9BLENBQUFBLEtBQVAsS0FBa0Isc0NBQWxCLENBQ0EsTUFBT0MsQ0FBQUEsZ0JBQVAsS0FBNkIsd0NBQTdCLENBRUE7OztHQUlBLFFBQVNDLENBQUFBLGdDQUFULENBQTBDQyxLQUExQyxDQUFpRCx1QkFDL0M7QUFDQSxLQUFNQyxDQUFBQSxrQkFBa0Isd0JBQUcsRUFBSCxDQUF4QixDQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FB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QUFPLENBQUNlLG9CQUFvQixDQUFDSSxPQUFyQixFQUFSLENBQXdDLENBQ3RDLHFDQUNBLEtBQU1OLENBQUFBLFdBQVcseUJBQUdFLG9CQUFvQixDQUFDSyxHQUFyQixFQUFILENBQWpCLENBRUE7QUFKc0MsdUJBS3RDSCw4QkFBOEIsQ0FBRyxFQUFqQyxDQUVBO0FBUHNDLHVCQVF0QyxHQUFJLENBQUN2QixrQkFBa0IsQ0FBQ21CLFdBQVcsQ0FBQ2IsTUFBWixFQUFELENBQXZCLENBQStDLGlEQUM3QztBQUNBVCxnQkFBZ0IsQ0FBQ0UsS0FBRCxDQUFRb0IsV0FBUixDQUFxQlosWUFBckIsQ0FBaEIsQ0FDRCxDQUhELCtCQUlELENBOUM4Qyx1QkFnRC9DLE1BQU9lLENBQUFBLCtCQUFQLENBQ0QsQ0FFRDs7Ozs7R0FNQSxjQUFlLFNBQVNLLENBQUFBLDJCQUFULENBQXFDNUIsS0FBckMsQ0FBNEMsdUJBQ3pEO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFNc0IsQ0FBQUEsb0JBQW9CLHlCQUFHdkIsZ0NBQWdDLENBQUNDLEtBQUQsQ0FBbkMsQ0FBMUIsQ0FFQTtBQVR5RCx1QkFVekRBLEtBQUssQ0FBQzZCLE9BQU4sR0FFQTtBQVp5RCx1QkFhekQsTUFBT1IsQ0FBQUEsVUFBVSxDQUFDckIsS0FBRCxDQUFRc0Isb0JBQVIsQ0FBakIsQ0FDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdGFjayBmcm9tICcuLi8uLi8uLi9kYXRhLXN0cnVjdHVyZXMvc3RhY2svU3RhY2snO1xuaW1wb3J0IGRlcHRoRmlyc3RTZWFyY2ggZnJvbSAnLi4vZGVwdGgtZmlyc3Qtc2VhcmNoL2RlcHRoRmlyc3RTZWFyY2gnO1xuXG4vKipcbiAqIEBwYXJhbSB7R3JhcGh9IGdyYXBoXG4gKiBAcmV0dXJuIHtTdGFja31cbiAqL1xuZnVuY3Rpb24gZ2V0VmVydGljZXNTb3J0ZWRCeURmc0ZpbmlzaFRpbWUoZ3JhcGgpIHtcbiAgLy8gU2V0IG9mIGFsbCB2aXNpdGVkIHZlcnRpY2VzIGR1cmluZyBERlMgcGFzcy5cbiAgY29uc3QgdmlzaXRlZFZlcnRpY2VzU2V0ID0ge307XG5cbiAgLy8gU3RhY2sgb2YgdmVydGljZXMgYnkgZmluaXNoIHRpbWUuXG4gIC8vIEFsbCB2ZXJ0aWNlcyBpbiB0aGlzIHN0YWNrIGFyZSBvcmRlcmVkIGJ5IGZpbmlzaGVkIHRpbWUgaW4gZGVjcmVhc2luZyBvcmRlci5cbiAgLy8gVmVydGV4IHRoYXQgaGFzIGJlZW4gZmluaXNoZWQgZmlyc3Qgd2lsbCBiZSBhdCB0aGUgYm90dG9tIG9mIHRoZSBzdGFjayBhbmRcbiAgLy8gdmVydGV4IHRoYXQgaGFzIGJlZW4gZmluaXNoZWQgbGFzdCB3aWxsIGJlIGF0IHRoZSB0b3Agb2YgdGhlIHN0YWNrLlxuICBjb25zdCB2ZXJ0aWNlc0J5RGZzRmluaXNoVGltZSA9IG5ldyBTdGFjaygpO1xuXG4gIC8vIFNldCBvZiBhbGwgdmVydGljZXMgd2UncmUgZ29pbmcgdG8gdmlzaXQuXG4gIGNvbnN0IG5vdFZpc2l0ZWRWZXJ0aWNlc1NldCA9IHt9O1xuICBncmFwaC5nZXRBbGxWZXJ0aWNlcygpLmZvckVhY2goKHZlcnRleCkgPT4ge1xuICAgIG5vdFZpc2l0ZWRWZXJ0aWNlc1NldFt2ZXJ0ZXguZ2V0S2V5KCldID0gdmVydGV4O1xuICB9KTtcblxuICAvLyBTcGVjaWZ5IERGUyB0cmF2ZXJzYWwgY2FsbGJhY2tzLlxuICBjb25zdCBkZnNDYWxsYmFja3MgPSB7XG4gICAgZW50ZXJWZXJ0ZXg6ICh7IGN1cnJlbnRWZXJ0ZXggfSkgPT4ge1xuICAgICAgLy8gQWRkIGN1cnJlbnQgdmVydGV4IHRvIHZpc2l0ZWQgc2V0LlxuICAgICAgdmlzaXRlZFZlcnRpY2VzU2V0W2N1cnJlbnRWZXJ0ZXguZ2V0S2V5KCldID0gY3VycmVudFZlcnRleDtcblxuICAgICAgLy8gRGVsZXRlIGN1cnJlbnQgdmVydGV4IGZyb20gbm90IHZpc2l0ZWQgc2V0LlxuICAgICAgZGVsZXRlIG5vdFZpc2l0ZWRWZXJ0aWNlc1NldFtjdXJyZW50VmVydGV4LmdldEtleSgpXTtcbiAgICB9LFxuICAgIGxlYXZlVmVydGV4OiAoeyBjdXJyZW50VmVydGV4IH0pID0+IHtcbiAgICAgIC8vIFB1c2ggdmVydGV4IHRvIHRoZSBzdGFjayB3aGVuIGxlYXZpbmcgaXQuXG4gICAgICAvLyBUaGlzIHdpbGwgbWFrZSBzdGFjayB0byBiZSBvcmRlcmVkIGJ5IGZpbmlzaCB0aW1lIGluIGRlY3JlYXNpbmcgb3JkZXIuXG4gICAgICB2ZXJ0aWNlc0J5RGZzRmluaXNoVGltZS5wdXNoKGN1cnJlbnRWZXJ0ZXgpO1xuICAgIH0sXG4gICAgYWxsb3dUcmF2ZXJzYWw6ICh7IG5leHRWZXJ0ZXggfSkgPT4ge1xuICAgICAgLy8gRG9uJ3QgYWxsb3cgdG8gdHJhdmVyc2UgdGhlIG5vZGVzIHRoYXQgaGF2ZSBiZWVuIGFscmVhZHkgdmlzaXRlZC5cbiAgICAgIHJldHVybiAhdmlzaXRlZFZlcnRpY2VzU2V0W25leHRWZXJ0ZXguZ2V0S2V5KCldO1xuICAgIH0sXG4gIH07XG5cbiAgLy8gRG8gRklSU1QgREZTIFBBU1MgdHJhdmVyc2FsIGZvciBhbGwgZ3JhcGggdmVydGljZXMgdG8gZmlsbCB0aGUgdmVydGljZXNCeUZpbmlzaFRpbWUgc3RhY2suXG4gIHdoaWxlIChPYmplY3QudmFsdWVzKG5vdFZpc2l0ZWRWZXJ0aWNlc1NldCkubGVuZ3RoKSB7XG4gICAgLy8gUGVlayBhbnkgdmVydGV4IHRvIHN0YXJ0IERGUyB0cmF2ZXJzYWwgZnJvbS5cbiAgICBjb25zdCBzdGFydFZlcnRleEtleSA9IE9iamVjdC5rZXlzKG5vdFZpc2l0ZWRWZXJ0aWNlc1NldClbMF07XG4gICAgY29uc3Qgc3RhcnRWZXJ0ZXggPSBub3RWaXNpdGVkVmVydGljZXNTZXRbc3RhcnRWZXJ0ZXhLZXldO1xuICAgIGRlbGV0ZSBub3RWaXNpdGVkVmVydGljZXNTZXRbc3RhcnRWZXJ0ZXhLZXldO1xuXG4gICAgZGVwdGhGaXJzdFNlYXJjaChncmFwaCwgc3RhcnRWZXJ0ZXgsIGRmc0NhbGxiYWNrcyk7XG4gIH1cblxuICByZXR1cm4gdmVydGljZXNCeURmc0ZpbmlzaFRpbWU7XG59XG5cbi8qKlxuICogQHBhcmFtIHtHcmFwaH0gZ3JhcGhcbiAqIEBwYXJhbSB7U3RhY2t9IHZlcnRpY2VzQnlGaW5pc2hUaW1lXG4gKiBAcmV0dXJuIHsqW119XG4gKi9cbmZ1bmN0aW9uIGdldFNDQ1NldHMoZ3JhcGgsIHZlcnRpY2VzQnlGaW5pc2hUaW1lKSB7XG4gIC8vIEFycmF5IG9mIGFycmF5cyBvZiBzdHJvbmdseSBjb25uZWN0ZWQgdmVydGljZXMuXG4gIGNvbnN0IHN0cm9uZ2x5Q29ubmVjdGVkQ29tcG9uZW50c1NldHMgPSBbXTtcblxuICAvLyBBcnJheSB0aGF0IHdpbGwgaG9sZCBhbGwgdmVydGljZXMgdGhhdCBhcmUgYmVpbmcgdmlzaXRlZCBkdXJpbmcgb25lIERGUyBydW4uXG4gIGxldCBzdHJvbmdseUNvbm5lY3RlZENvbXBvbmVudHNTZXQgPSBbXTtcblxuICAvLyBWaXNpdGVkIHZlcnRpY2VzIHNldC5cbiAgY29uc3QgdmlzaXRlZFZlcnRpY2VzU2V0ID0ge307XG5cbiAgLy8gQ2FsbGJhY2tzIGZvciBERlMgdHJhdmVyc2FsLlxuICBjb25zdCBkZnNDYWxsYmFja3MgPSB7XG4gICAgZW50ZXJWZXJ0ZXg6ICh7IGN1cnJlbnRWZXJ0ZXggfSkgPT4ge1xuICAgICAgLy8gQWRkIGN1cnJlbnQgdmVydGV4IHRvIFNDQyBzZXQgb2YgY3VycmVudCBERlMgcm91bmQuXG4gICAgICBzdHJvbmdseUNvbm5lY3RlZENvbXBvbmVudHNTZXQucHVzaChjdXJyZW50VmVydGV4KTtcblxuICAgICAgLy8gQWRkIGN1cnJlbnQgdmVydGV4IHRvIHZpc2l0ZWQgc2V0LlxuICAgICAgdmlzaXRlZFZlcnRpY2VzU2V0W2N1cnJlbnRWZXJ0ZXguZ2V0S2V5KCldID0gY3VycmVudFZlcnRleDtcbiAgICB9LFxuICAgIGxlYXZlVmVydGV4OiAoeyBwcmV2aW91c1ZlcnRleCB9KSA9PiB7XG4gICAgICAvLyBPbmNlIERGUyB0cmF2ZXJzYWwgaXMgZmluaXNoZWQgcHVzaCB0aGUgc2V0IG9mIGZvdW5kIHN0cm9uZ2x5IGNvbm5lY3RlZFxuICAgICAgLy8gY29tcG9uZW50cyBkdXJpbmcgY3VycmVudCBERlMgcm91bmQgdG8gb3ZlcmFsbCBzdHJvbmdseSBjb25uZWN0ZWQgY29tcG9uZW50cyBzZXQuXG4gICAgICAvLyBUaGUgc2lnbiB0aGF0IHRyYXZlcnNhbCBpcyBhYm91dCB0byBiZSBmaW5pc2hlZCBpcyB0aGF0IHdlIGNhbWUgYmFjayB0byBzdGFydCB2ZXJ0ZXhcbiAgICAgIC8vIHdoaWNoIGRvZXNuJ3QgaGF2ZSBwYXJlbnQuXG4gICAgICBpZiAocHJldmlvdXNWZXJ0ZXggPT09IG51bGwpIHtcbiAgICAgICAgc3Ryb25nbHlDb25uZWN0ZWRDb21wb25lbnRzU2V0cy5wdXNoKFsuLi5zdHJvbmdseUNvbm5lY3RlZENvbXBvbmVudHNTZXRdKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGFsbG93VHJhdmVyc2FsOiAoeyBuZXh0VmVydGV4IH0pID0+IHtcbiAgICAgIC8vIERvbid0IGFsbG93IHRyYXZlcnNhbCBvZiBhbHJlYWR5IHZpc2l0ZWQgdmVydGljZXMuXG4gICAgICByZXR1cm4gIXZpc2l0ZWRWZXJ0aWNlc1NldFtuZXh0VmVydGV4LmdldEtleSgpXTtcbiAgICB9LFxuICB9O1xuXG4gIHdoaWxlICghdmVydGljZXNCeUZpbmlzaFRpbWUuaXNFbXB0eSgpKSB7XG4gICAgLyoqIEB2YXIge0dyYXBoVmVydGV4fSBzdGFydFZlcnRleCAqL1xuICAgIGNvbnN0IHN0YXJ0VmVydGV4ID0gdmVydGljZXNCeUZpbmlzaFRpbWUucG9wKCk7XG5cbiAgICAvLyBSZXNldCB0aGUgc2V0IG9mIHN0cm9uZ2x5IGNvbm5lY3RlZCB2ZXJ0aWNlcy5cbiAgICBzdHJvbmdseUNvbm5lY3RlZENvbXBvbmVudHNTZXQgPSBbXTtcblxuICAgIC8vIERvbid0IGRvIERGUyBvbiBhbHJlYWR5IHZpc2l0ZWQgdmVydGljZXMuXG4gICAgaWYgKCF2aXNpdGVkVmVydGljZXNTZXRbc3RhcnRWZXJ0ZXguZ2V0S2V5KCldKSB7XG4gICAgICAvLyBEbyBERlMgdHJhdmVyc2FsLlxuICAgICAgZGVwdGhGaXJzdFNlYXJjaChncmFwaCwgc3RhcnRWZXJ0ZXgsIGRmc0NhbGxiYWNrcyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHN0cm9uZ2x5Q29ubmVjdGVkQ29tcG9uZW50c1NldHM7XG59XG5cbi8qKlxuICogS29zYXJhanUncyBhbGdvcml0aG0uXG4gKlxuICogQHBhcmFtIHtHcmFwaH0gZ3JhcGhcbiAqIEByZXR1cm4geypbXX1cbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gc3Ryb25nbHlDb25uZWN0ZWRDb21wb25lbnRzKGdyYXBoKSB7XG4gIC8vIEluIHRoaXMgYWxnb3JpdGhtIHdlIHdpbGwgbmVlZCB0byBkbyBUV08gREZTIFBBU1NFUyBvdmVydCB0aGUgZ3JhcGguXG5cbiAgLy8gR2V0IHN0YWNrIG9mIHZlcnRpY2VzIG9yZGVyZWQgYnkgREZTIGZpbmlzaCB0aW1lLlxuICAvLyBBbGwgdmVydGljZXMgaW4gdGhpcyBzdGFjayBhcmUgb3JkZXJlZCBieSBmaW5pc2hlZCB0aW1lIGluIGRlY3JlYXNpbmcgb3JkZXI6XG4gIC8vIFZlcnRleCB0aGF0IGhhcyBiZWVuIGZpbmlzaGVkIGZpcnN0IHdpbGwgYmUgYXQgdGhlIGJvdHRvbSBvZiB0aGUgc3RhY2sgYW5kXG4gIC8vIHZlcnRleCB0aGF0IGhhcyBiZWVuIGZpbmlzaGVkIGxhc3Qgd2lsbCBiZSBhdCB0aGUgdG9wIG9mIHRoZSBzdGFjay5cbiAgY29uc3QgdmVydGljZXNCeUZpbmlzaFRpbWUgPSBnZXRWZXJ0aWNlc1NvcnRlZEJ5RGZzRmluaXNoVGltZShncmFwaCk7XG5cbiAgLy8gUmV2ZXJzZSB0aGUgZ3JhcGguXG4gIGdyYXBoLnJldmVyc2UoKTtcblxuICAvLyBEbyBERlMgb25jZSBhZ2FpbiBvbiByZXZlcnNlZCBncmFwaC5cbiAgcmV0dXJuIGdldFNDQ1NldHMoZ3JhcGgsIHZlcnRpY2VzQnlGaW5pc2hUaW1lKTtcbn1cbiJdfQ==